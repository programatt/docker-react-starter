version: '2.1'

services:
  client:
    hostname: client
    build: ./client/
    volumes:
      - '/usr/src/app/node_modules'
      - './client:/usr/src/app'
    #Disable the host port mapping
    #ports:
    #  - "3000:3000"
    expose:
      - "3000"
    env_file: '.env.local'
    environment:
      - NODE_ENV=${NODE_ENV}

  nginx:
    build: ./nginx/
    ports:
      - "80:80"
    links:
      - client
      - api
    depends_on:
      - client
      - api

  api:
    hostname: api
    build: ./api/
    command: npm start
    expose:
      - "8080"
    #ports:
    #  - "8080:8080"
    links:
      - mongodb
      - mongodb:mongodb.cloud66.local
    environment:
      - NODE_ENV=production
      - MONGODB_ADDRESS=mongodb

  mongodb:
    image: mongo
